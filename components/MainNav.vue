<template>
    <header id='headercontainer'>
        <div id='header'>
            <div id='logo'>
                <svg width="284.75693" height="413.3757" viewBox="0 0 284.75693 413.3757">
                    <nuxt-link to='/'>
                        <g
                            id="g832"
                            transform="matrix(0.629735,0,0,0.629735,22.094624,-17.644399)">
                            <path
                            style="fill:#ff0000;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
                            d="M 301.157,414.82 C 346.445,453.998 359.329,492.582 364.588,505.011 C 367.602,514.375 369.524,519.135 364.213,524.102 C 356.306,531.494 325.136,540.486 312.09,566.263 C 299.041,592.04 288.224,610.81 273.905,624.334 C 259.586,637.857 226.176,648.198 218.483,661.05 C 210.79,673.902 202.909,676.836 197.548,676.836 C 186.984,676.836 187.915,676.836 182.544,676.836 C 177.173,676.836 169.292,673.902 161.599,661.05 C 153.906,648.198 120.496,637.857 106.177,624.334 C 91.8584,610.81 81.0426,592.04 67.9938,566.263 C 54.945,540.486 23.7731,531.494 15.8682,524.102 C 10.5557,519.135 12.4785,514.375 15.4918,505.011 C 20.7522,492.582 35.622,454.214 78.9247,414.82 C 82.3997,410.607 90.4997,397.47 79.7829,343.136 C 73.1584,301.81 133.886,247.476 128.343,192.907 C 134.832,214.07 143.438,214.854 130.645,236.898 C 94.3091,293.806 110.364,332.23 120.298,333.564 C 135.088,333.029 115.087,265.152 148.096,235.096 C 160.877,221.451 237.355,198.838 247.488,113.523 C 261.299,209.108 186.194,278.16 207.337,285.256 C 235.551,294.175 224.521,247.088 248.54,203.812 C 277.424,154.183 318.845,161.261 389.083,31.8258 C 324,164.854 345.36,210.96 323.519,241.984 C 300.689,275.102 246.655,292.833 262.83,311.269 C 271.087,322.544 309.41,271.46 326.259,253.105 C 353.245,222.597 393.146,221.658 412.639,188.256 C 379.591,240.516 339.922,246.665 332.613,283.16 C 310.709,395.845 272.34,388.488 301.157,414.82 z M 286.292,47.6168 C 284.994,67.3111 288.627,65.1171 287.395,70.227 C 285.052,78.8911 253.02,81.6238 247.689,102.763 C 247.128,86.7741 243.582,85.8322 244.381,81.8071 C 245.806,75.6105 284.087,66.55 286.292,47.6168 z M 151.183,200.924 C 161.016,170.4 146.693,156.646 146.85,148.439 C 148.448,138.036 150.504,146.303 163.26,113.146 C 152.058,149.66 167.157,163.431 164.608,170.554 C 162.641,177.151 161.511,173.019 151.183,200.924 z M 109.652,574.358 C 138.856,590.761 145.964,592.39 163.567,595.69 C 167.352,607.638 170.428,610.002 174.213,616.983 C 175.633,607.282 175.633,605.741 177.762,598.175 C 186.28,598.528 193.801,598.528 202.318,598.175 C 204.448,605.741 204.447,607.282 205.867,616.983 C 209.653,610.002 212.728,607.638 216.513,595.69 C 234.116,592.39 241.225,590.761 270.428,574.358 C 234.7,606.607 220.06,624.324 206.332,654.976 C 205.779,650.355 204.517,647.861 202.545,643.237 C 201.525,652.341 200.812,656.863 198.996,661.865 C 190.355,665.193 189.725,665.193 181.084,661.865 C 179.268,656.863 178.556,652.341 177.535,643.237 C 175.563,647.861 174.301,650.355 173.749,654.976 C 160.02,624.324 146.967,606.607 109.652,574.358 z M 266.828,507.031 C 268.48,506.242 275.939,503.474 277.367,503.601 C 278.753,503.69 288.105,511.734 287.907,513.309 C 287.288,519.769 282.83,526.89 268.835,534.892 C 273.185,526.358 271.92,513.341 266.828,507.031 z M 113.252,507.031 C 111.6,506.242 104.142,503.474 102.713,503.601 C 101.327,503.69 91.9748,511.734 92.1737,513.309 C 92.7919,519.769 97.2498,526.89 111.245,534.892 C 106.896,526.358 108.16,513.341 113.252,507.031 z M 121.283,537.403 C 138.796,538.472 149.406,539.334 150.635,536.397 C 151.923,533.849 135.499,521.916 122.287,511.54 C 125.298,523.084 124.908,525.623 121.283,537.403 z M 258.797,537.403 C 241.284,538.472 230.674,539.334 229.445,536.397 C 228.157,533.849 244.582,521.916 257.793,511.54 C 254.782,523.084 255.172,525.623 258.797,537.403 z"
                            id="path833" />
                        </g>
                    </nuxt-link>
                </svg>
            </div>
            <div id='headericons'>
                <a href='mailto:rick@firefang.com'><img src='~/assets/images/icons/mail.svg' :height='iconheight' alt='email'/></a>
                <a href='https://facebook.com/skrapion'><img src='~/assets/images/icons/facebook.svg' :height='iconheight' alt='Facebook'/></a>
                <a href='https://www.youtube.com/channel/UCLCEtL5d5botNpR4TCU_f9w'><img src='~/assets/images/icons/youtube.svg' :height='iconheight' alt='Youtube'/></a>
                <div id='notification-block' v-click-outside="hideNotify"><a href='#' v-on:click="showNotify = !showNotify"><img src='~/assets/images/icons/bell.svg' :height='iconheight' alt='notifications'/></a><div id='subscribe' :class="{show: showNotify}"><div id='subscribe-content'><p class='unsupported-message'>Sorry, web push notifications aren't supported on your platform.</p><p>Want to be notified whenever I post a new project?</p><div :class='{switchtrack: true, set: subscribed}' v-on:click="clickSubscribe()"><div class='switchthumb'></div></div></div></div></div>
            </div>
        </div>
    </header>
</template>

<script>
import vClickOutside from 'v-click-outside'

export default {
    data() {
        return {
            iconheight: 24,
            showNotify: false,
            subscribed: false
        }
    },
    mounted() {
        if(process.env.NODE_ENV === 'production') {
            if(typeof OneSignal === 'undefined') {
                window.OneSignal = window.OneSignal || [];
                OneSignal.push(function() {
                    OneSignal.init({
                        appId: "3b78268c-b1c0-4037-b3f5-07cb3afb64fe",
                    });
                });
            }

            if(!OneSignal.isPushNotificationsSupported()) {
                var subscribeContent = document.getElementById("subscribe-content");
                subscribeContent.classList.add("unsupported");
            } else {
                OneSignal.isPushNotificationsEnabled().then(enabled => {
                    this.subscribed = enabled;
                });
            }
        }
    },
    directives: {
        clickOutside: vClickOutside.directive
    },
    methods: {
        hideNotify(event) {
            this.showNotify = false;
        },
        clickSubscribe() {
            if(typeof OneSignal !== 'undefined') {
                Promise.all([
                    OneSignal.isPushNotificationsEnabled(),
                    OneSignal.isOptedOut()
                ]).then(values => {
                    const [enabled, optedOut] = [values[0], values[1]];
                    if(enabled) {
                        OneSignal.setSubscription(false);
                        this.subscribed = false;
                    } else {
                        if(optedOut) {
                            OneSignal.setSubscription(true);
                        } else {
                            OneSignal.registerForPushNotifications();
                        }
                        this.subscribed = true;
                        OneSignal.sendSelfNotification("Thank you for subscribing!", "Watch this space for new project posts!", "https://firefang.com", "https://nuxt.firefang.com/hellcat.png");
                    }
                });
            }
        }
    }
}
</script>